# シャッフル機能 - 要件定義書

## 1. 目的

組織内のナレッジ共有を促進するため、ランダムに選ばれたメンバーに質問を送信し、その回答を全体に共有することで、メンバー間の知識・経験・スキルの可視化と相互理解を深める。

## 2. 現状把握

### 実装済み機能（70%完了）
- ✅ ShuffleService（質問配信ロジック）
- ✅ QuestionRepository（質問管理）
- ✅ ScheduleManager（定期実行管理）
- ✅ ShuffleHandler（ユーザーインタラクション）
- ✅ データベーステーブル（questions, shuffle_responses）
- ✅ デフォルト質問50個（シード済み）
- ✅ 管理者コマンド（/khub-admin shuffle-*）

### 未実装機能
- ❌ エンドユーザー向け `/shuffle` コマンド
- ❌ 質問カスタマイズUI
- ❌ 除外ユーザー設定
- ❌ チャンネル指定機能
- ❌ 詳細な統計ダッシュボード

## 3. 機能要件

### 3.1 エンドユーザー向けコマンド
- `/shuffle` - シャッフル機能のヘルプと状態確認
- `/shuffle stats` - 自分の回答履歴と統計
- `/shuffle history` - 最近の回答一覧表示

### 3.2 質問管理機能
- 管理者による質問の追加・編集・削除
- カテゴリー別の質問管理
- 質問の有効/無効切り替え
- カスタム質問の作成（最大50個）

### 3.3 配信設定機能
- 配信先チャンネルの指定
- 除外ユーザーの設定
- 配信頻度の調整
- 配信時間の設定

### 3.4 統計・分析機能
- 回答率の可視化
- カテゴリー別の回答傾向
- アクティブユーザーランキング
- 知識マップの生成

## 4. 非機能要件

### 4.1 パフォーマンス
- 質問送信: 3秒以内
- 統計取得: 2秒以内
- 同時処理: 100ユーザーまで対応

### 4.2 ユーザビリティ
- 直感的なコマンド体系
- わかりやすいエラーメッセージ
- 日本語対応

### 4.3 セキュリティ
- プライベートチャンネルへの配信制限
- 個人情報の適切な管理
- 回答内容の編集・削除権限

## 5. 成功基準

1. **利用率**: 月間アクティブユーザー60%以上
2. **回答率**: 質問送信に対する回答率70%以上
3. **満足度**: ユーザー満足度4.0/5.0以上
4. **知識共有**: 月間100件以上の知識共有

## 6. 制約事項

1. 既存のコア実装を活用する
2. Slack APIのレート制限を考慮
3. 既存の管理者コマンドとの整合性を保つ
4. Socket Modeでの動作を前提とする

## 7. 今回の開発スコープ

### Phase 1（今回実装）
1. `/shuffle` コマンドの実装
2. 基本的な統計表示機能
3. チャンネル指定機能
4. エラーハンドリングの改善

### Phase 2（将来実装）
1. 質問カスタマイズUI
2. 除外ユーザー設定
3. 詳細な統計ダッシュボード
4. 知識マップ機能