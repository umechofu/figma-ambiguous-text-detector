# アンケート機能 - 要件定義書

## 現状分析

### 既存実装状況
- **Survey データモデル**: 完全実装済み（Survey, SurveyResponse テーブル）
- **サービス層**: 部分実装済み（SurveyService, SurveyBuilder, ResponseCollector）
- **Slack ハンドラー**: スケルトン実装（SurveyHandler.ts）
- **コマンド登録**: `/survey` コマンド構造は存在

### 要件概要

**ユーザーストーリー:** 管理者として、構造化されたアンケートを通じて組織の意見やフィードバックを効率的に収集したい

## 機能要件

### R1. アンケート作成機能
**受け入れ基準:**
1. WHEN 管理者が `/survey create` を実行 THEN システムはアンケート作成フォームを表示する
2. WHEN アンケートタイトルと説明を入力 THEN システムは質問追加インターフェースを提供する
3. WHEN 質問を追加 THEN システムは選択式・自由記述・評価スケール等の質問タイプに対応する
4. WHEN アンケート作成完了 THEN システムはアンケートを保存し、配信準備状態にする

### R2. アンケートテンプレート機能
**受け入れ基準:**
1. WHEN 管理者がテンプレートを選択 THEN システムは事前定義されたアンケート形式を提供する
2. WHEN テンプレートカテゴリーが必要 THEN システムは「従業員満足度」「チーム評価」「研修効果」等を提供する
3. WHEN テンプレートをカスタマイズ THEN システムは質問の追加・削除・編集を許可する

### R3. アンケート配信機能
**受け入れ基準:**
1. WHEN 管理者が `/survey send` を実行 THEN システムは配信先チャンネル選択を提供する
2. WHEN アンケートが配信される THEN システムはSlack内で完結する回答インターフェースを表示する
3. WHEN 有効期限を設定 THEN システムは期限後の回答を自動的に締め切る

### R4. 回答収集機能
**受け入れ基準:**
1. WHEN ユーザーがアンケートに回答 THEN システムは回答データを即座に保存する
2. WHEN 匿名回答オプション THEN システムは回答者IDを記録せずに集計する
3. WHEN 回答状況確認 THEN システムは回答率と未回答者リストを提供する

### R5. 結果集計・分析機能
**受け入れ基準:**
1. WHEN アンケート終了後 THEN システムは自動的に結果を集計・可視化する
2. WHEN 選択式質問の場合 THEN システムは円グラフ・棒グラフでの可視化を提供する
3. WHEN 自由記述の場合 THEN システムはテキスト分析（キーワード抽出等）を提供する
4. WHEN 結果をエクスポート THEN システムはCSV・PDF形式での出力を提供する

## 非機能要件

### UX要件
- **操作負担最小化**: 作成者・回答者双方で3クリック以内での操作完了
- **直感的操作**: Slackネイティブなインターフェース設計
- **レスポンス速度**: アンケート表示は2秒以内

### セキュリティ要件
- **データ保護**: 個人回答データの暗号化保存
- **アクセス制御**: 管理者のみアンケート作成・結果閲覧可能
- **匿名性保証**: 匿名アンケートでの回答者特定不可

### スケーラビリティ要件
- **大規模対応**: 1000名規模の組織での利用
- **同時回答**: 100名の同時回答処理
- **データ保存**: 過去アンケートの永続的保存

## 成功基準

### 定量指標
- アンケート作成時間: 従来の70%削減（10分→3分）
- 回答率: 従来比150%向上（40%→60%）
- 結果確認時間: 従来の80%削減（30分→6分）

### 定性指標
- 管理者満足度: 「使いやすい」評価80%以上
- 回答者満足度: 「回答しやすい」評価75%以上
- 運用継続率: 導入後6ヶ月の継続利用率90%以上

## 制約条件

### 技術制約
- Slack App Manifest上限内でのUI構築
- Supabase Row Level Security (RLS) での権限制御
- Socket Mode での双方向通信実装

### 運用制約
- 管理者権限はSlackワークスペース管理者に準拠
- アンケートデータの保持期間: 2年間
- 同時実行可能アンケート数: チャンネルあたり1つ